<Window x:Class="ServiceManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Menedżer serwisów synchronizacji" Height="720" Width="1100" Loaded="Window_Loaded">
    <Window.Resources>
        <!-- Styles -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="10" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="Margin" Value="6" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
        <Style TargetType="TextBlock" x:Key="SectionTitle">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="6" />
        </Style>
        <Style x:Key="NavRadioButtonStyle" TargetType="RadioButton">
            <Setter Property="Padding" Value="10" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="Margin" Value="6,4" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="Background" Value="#FFFFFF" />
            <Setter Property="BorderBrush" Value="#B0B6C0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        SnapsToDevicePixels="True"
                        CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center" Margin="{TemplateBinding Padding}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <!-- Hover effect -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#D0D8E0" />
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Black" BlurRadius="6" ShadowDepth="1" Opacity="0.2" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <!-- Checked (selected) -->
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#5A7DA7" />
                                <Setter TargetName="border" Property="BorderBrush" Value="#3B5C88" />
                                <Setter Property="Foreground" Value="White" />
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Black" BlurRadius="8" ShadowDepth="2" Opacity="0.3" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="Background" Value="White" />
            <Setter Property="Margin" Value="0,0,0,2" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" SnapsToDevicePixels="True" CornerRadius="4">
                            <!-- This is key: GridViewRowPresenter preserves column bindings -->
                            <GridViewRowPresenter Content="{TemplateBinding Content}"
                                          Columns="{TemplateBinding GridView.ColumnCollection}"
                                          Margin="{TemplateBinding Padding}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#EFF6FF" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#3B82F6" />
                                <Setter Property="Foreground" Value="White" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Service selection overlay -->
        <Grid x:Name="ServiceSelectionOverlay" Background="#CCFFFFFF" Visibility="Visible" ZIndex="10">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Wybierz serwis do obserwacji" FontSize="24" FontWeight="Bold" Margin="0,0,0,20" HorizontalAlignment="Center" />
                <ItemsControl x:Name="IcAvailableServices"
                              ItemsSource="{Binding AvailableServices}"
                              HorizontalAlignment="Center">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Click="ServiceButton_Click"
                                    Margin="10"
                                    Padding="6"
                                    Width="240" Height="240"
                                    Tag="{Binding Id}">
                                <StackPanel>
                                    <Image Source="{Binding LogoPath}" Width="180" Height="180" HorizontalAlignment="Center" />
                                    <TextBlock Text="{Binding Name}" HorizontalAlignment="Center" Margin="0,6,0,0" />
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Grid>

        <Grid x:Name="MainContentAreaNav" Visibility="Collapsed">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Left navigation panel -->
            <Border Grid.Column="0" Background="#E0E4EA" BorderBrush="#B0B6C0" BorderThickness="0,0,1,0" Padding="8">
                <DockPanel>

                    <!-- Top header + nav buttons -->
                    <StackPanel DockPanel.Dock="Top">
                        <ComboBox x:Name="CbServiceSelector"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Top"
                          Margin="10,0,10,0"
                          Visibility="Collapsed"
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id"
                          SelectionChanged="CbServiceSelector_SelectionChanged" />
                        <TextBlock x:Name="ServiceNameTextBox" Text="..." FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Margin="6,6,6,0" />
                        <TextBlock Text="Panel" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" />

                        <!-- Nav buttons -->
                        <StackPanel Margin="6,20,6,6">
                            <RadioButton x:Name="BtnShowLogs" Style="{StaticResource NavRadioButtonStyle}" GroupName="NavGroup" Click="BtnShowLogs_Click">
                                Podgląd logów
                            </RadioButton>
                            <RadioButton x:Name="BtnShowConfig" Style="{StaticResource NavRadioButtonStyle}" GroupName="NavGroup" Click="BtnShowConfig_Click">
                                Konfiguracja serwisu
                            </RadioButton>
                        </StackPanel>
                    </StackPanel>

                    <!-- Bottom controls -->
                    <StackPanel DockPanel.Dock="Bottom" Margin="6" Orientation="Vertical" VerticalAlignment="Bottom">

                        <!-- Service control buttons in one row -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                            <Button x:Name="BtnStartService" Width="50" Height="40" Margin="4" Click="BtnStartService_Click">
                                <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE768;" FontSize="16" HorizontalAlignment="Center" />
                                    <!-- Play icon -->
                                    <TextBlock Text="Start" FontSize="10" HorizontalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button x:Name="BtnStopService" Width="50" Height="40" Margin="4" Click="BtnStopService_Click">
                                <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE71A;" FontSize="16" HorizontalAlignment="Center" />
                                    <!-- Stop icon -->
                                    <TextBlock Text="Stop" FontSize="10" HorizontalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button x:Name="BtnRestartService" Width="50" Height="40" Margin="4" Click="BtnRestartService_Click">
                                <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72C;" FontSize="16" HorizontalAlignment="Center" />
                                    <!-- Refresh icon -->
                                    <TextBlock Text="Restart" FontSize="10" HorizontalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Service status -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Ellipse x:Name="ServiceStatusDot" Width="12" Height="12" Fill="Red" Margin="0,0,6,0" />
                            <TextBlock x:Name="ServiceStatusText" Text="Offline" VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- Main content area -->
            <Grid Grid.Column="1" x:Name="MainContentArea" Visibility="Collapsed">
                <!-- Views placed here and shown/hidden from code-behind -->
                <Grid x:Name="LogsViewContainer">
                    <!-- Top toolbar -->
                    <DockPanel LastChildFill="True" Margin="8">
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                            <TextBlock Text="Auto-odświeżanie co 5s" VerticalAlignment="Center" Margin="6,0,0,0" />
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Files list -->
                            <Border Grid.Column="0" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="6" Padding="6" Margin="0,0,8,0" Background="White" SnapsToDevicePixels="True">
                                <StackPanel>
                                    <TextBlock Text="Pliki logów" Style="{StaticResource SectionTitle}" Margin="0,0,0,6" />
                                    <ListView x:Name="LvLogFiles" SelectionChanged="LvLogFiles_SelectionChanged"
                                      Background="White" BorderThickness="0"
                                      AlternationCount="2"
                                      ItemContainerStyle="{StaticResource ListViewItemStyle}">
                                        <ListView.View>
                                            <GridView>
                                                <GridViewColumn Header="Data" Width="Auto" DisplayMemberBinding="{Binding Name}" />
                                                <GridViewColumn Header="Ostrzeżenia" Width="Auto" DisplayMemberBinding="{Binding WarningsCount}" />
                                                <GridViewColumn Header="Błędy" Width="53" DisplayMemberBinding="{Binding ErrorsCount}" />
                                            </GridView>
                                        </ListView.View>
                                    </ListView>
                                </StackPanel>
                            </Border>

                            <!-- File content -->
                            <Border Grid.Column="1" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="6" Padding="8">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>

                                    <StackPanel Orientation="Horizontal" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="0,0,0,8">
                                        <TextBlock Text="Zawartość pliku:" FontWeight="Bold" Margin="0,0,8,0" VerticalAlignment="Center" />
                                        <TextBlock x:Name="TxtSelectedFileName" Text="(brak)" VerticalAlignment="Center" Margin="0,0,16,0" />
                                        <CheckBox x:Name="ChkShowOnlyWarningsAndErrors" Content="Pokaż tylko ostrzeżenia i błędy"
                                          VerticalAlignment="Center"
                                          Checked="ChkShowOnlyWarningsAndErrors_Changed"
                                          Unchecked="ChkShowOnlyWarningsAndErrors_Changed" />
                                    </StackPanel>

                                    <ListBox Grid.Row="1"
                                     x:Name="IcLogLines"
                                     ItemsSource="{Binding}"
                                     VirtualizingStackPanel.IsVirtualizing="True"
                                     VirtualizingStackPanel.VirtualizationMode="Recycling"
                                     ScrollViewer.CanContentScroll="True"
                                     ScrollViewer.VerticalScrollBarVisibility="Visible"
                                     BorderThickness="0">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Message}" TextWrapping="Wrap" Margin="2">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="Black" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Level}" Value="Information">
                                                                    <Setter Property="Foreground" Value="Green" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Level}" Value="Warning">
                                                                    <Setter Property="Foreground" Value="Orange" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Level}" Value="Error">
                                                                    <Setter Property="Foreground" Value="Red" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </Grid>
                            </Border>
                        </Grid>
                    </DockPanel>
                </Grid>

                <!-- Configuration view - hidden by default -->
                <Grid x:Name="ConfigViewContainer" Visibility="Collapsed" Margin="8">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="ConfigStackPanel" />
                    </ScrollViewer>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Window>